(this["webpackJsonpmemory-front"]=this["webpackJsonpmemory-front"]||[]).push([[0],{36:function(e,t,a){e.exports=a(68)},41:function(e,t,a){},43:function(e,t,a){},68:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(33),o=a.n(c),s=(a(41),a(4)),u=a(1),l=a.n(u),i=a(2),p=a(3),m=(a(43),a(5)),f=a(35),d=Object(n.createContext)(null),h=function(e){var t=e.component,a=Object(f.a)(e,["component"]),c=Object(n.useContext)(d).user;return r.a.createElement(m.b,Object.assign({},a,{render:function(e){return c?r.a.createElement(t,e):r.a.createElement(m.a,{to:{pathname:"/login",state:{from:e.location}}})}}))},b=a(10),v=a(11),E=a(6),k=a.n(E),y=function(){function e(){Object(b.a)(this,e)}return Object(v.a)(e,null,[{key:"setStorage",value:function(e,t){try{localStorage.setItem(e,t)}catch(a){console.error(a)}}},{key:"getStorage",value:function(e){try{return localStorage.getItem(e)}catch(t){console.error(t)}}},{key:"deleteStorageItem",value:function(){try{for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];t.forEach((function(e){localStorage.removeItem(e)}))}catch(n){console.error(n)}}}]),e}(),g=function(){function e(){Object(b.a)(this,e)}return Object(v.a)(e,null,[{key:"setInterceptors",value:function(e){k.a.defaults.headers.common[["Authorization"]]="Bearer ".concat(e)}}]),e}(),x=function(){function e(){Object(b.a)(this,e)}return Object(v.a)(e,null,[{key:"requestTokens",value:function(){var t=Object(i.a)(l.a.mark((function t(a,n){var r;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,k.a.post("".concat("https://memory-school-api.herokuapp.com/","api/login_check"),{username:a,password:n});case 3:(r=t.sent)&&r.data&&e.setTokens(r.data),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),console.error("requestTokens : ".concat(t.t0));case 10:case"end":return t.stop()}}),t,null,[[0,7]])})));return function(e,a){return t.apply(this,arguments)}}()},{key:"fetchUserData",value:function(){var e=Object(i.a)(l.a.mark((function e(){var t,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,k.a.get("".concat("https://memory-school-api.herokuapp.com/","api/account"));case 3:if(!(t=e.sent)||!t.data){e.next=7;break}return a=t.data,e.abrupt("return",a);case 7:e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),console.error("fetchUserData : ".concat(e.t0));case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(){return e.apply(this,arguments)}}()},{key:"refreshTokens",value:function(){var t=Object(i.a)(l.a.mark((function t(){var a;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,k.a.post("".concat("https://memory-school-api.herokuapp.com/","api/token/refresh"),{refresh_token:this.getRefreshToken()});case 3:(a=t.sent)&&a.data&&e.setTokens(a.data),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),console.error("refreshTokens : ".concat(t.t0));case 10:case"end":return t.stop()}}),t,this,[[0,7]])})));return function(){return t.apply(this,arguments)}}()},{key:"setTokens",value:function(e){y.setStorage("JWT",e.token),y.setStorage("JWT_REFRESH",e.refresh_token),g.setInterceptors(this.getAccessToken())}},{key:"getAccessToken",value:function(){return y.getStorage("JWT")}},{key:"getRefreshToken",value:function(){return y.getStorage("JWT_REFRESH")}},{key:"clearTokens",value:function(){y.deleteStorageItem("JWT","JWT_REFRESH")}},{key:"createAccount",value:function(){var e=Object(i.a)(l.a.mark((function e(t,a,n){var r,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,k.a.post("".concat("https://memory-school-api.herokuapp.com/","api/user/new"),t);case 3:(r=e.sent)&&r.data&&(console.log(r.data),console.log("nouvel utilisateur cr\xe9\xe9 !")),e.next=11;break;case 7:if(e.prev=7,e.t0=e.catch(0),console.log(e.t0),401===e.t0.response.status){for(c in a)delete a[c];a.err401="Un compte a d\xe9j\xe0 \xe9t\xe9 cr\xe9er avec cette adresse email",n(a)}case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,a,n){return e.apply(this,arguments)}}()}]),e}();var O=function(){var e=Object(n.useContext)(d),t=e.user,a=e.setUser;return r.a.createElement("div",null,r.a.createElement("h1",null,"Homepage"),r.a.createElement("p",null,t?"Bonjour, ".concat(t.firstName):""),r.a.createElement(s.b,{to:"/login"},r.a.createElement("button",{type:"button"},"Log in")),r.a.createElement(s.b,{to:"/register"},r.a.createElement("button",{type:"button"},"Register")),r.a.createElement("button",{type:"button",onClick:function(){x.clearTokens(),a(null)}},"logout"),r.a.createElement(s.b,{to:"/account"},r.a.createElement("button",{type:"button"},"Mes espaces")),t&&t.roles.includes("ROLE_BACK_MANAGER")?r.a.createElement(s.b,{to:"/admin"},r.a.createElement("button",{type:"button"},"Back Office")):"")},j=a(17),w=a(13),S=a(18),N=function(){var e=Object(n.useState)({}),t=Object(p.a)(e,2),a=t[0],r=t[1];return[a,function(e){e.persist(),"file"===e.target.type?"images"===e.target.name?r((function(){return Object(S.a)({},a,Object(w.a)({},e.target.name,Object.values(e.target.files)))})):r((function(){return Object(S.a)({},a,Object(w.a)({},e.target.name,e.target.files[0]))})):r((function(){return Object(S.a)({},a,Object(w.a)({},e.target.name,e.target.value))}))}]},C=function(e){var t,a=new FormData;return Object.keys(e).forEach((function(t){var n=t,r=e[t];"images"===n?r.forEach((function(e){a.append(e.name,e)})):a.append(n,r)})),(t=console).log.apply(t,Object(j.a)(a)),a};var T=function(){return r.a.createElement("div",null,"Fetching user data... Ici, peut-\xeatre une animation super classe, tout en restant sobre \xe9videmment ?"," ",r.a.createElement("span",{role:"img","aria-label":"emoji"},"\ud83d\ude0e\ud83d\ude0e\ud83d\ude0e")," ")};var F=function(e){var t=e.location,a=N(),c=Object(p.a)(a,2),o=c[0],u=c[1],f=Object(n.useContext)(d),h=f.user,b=f.setUser,v=Object(n.useState)(!1),E=Object(p.a)(v,2),k=E[0],y=E[1];if(k)return r.a.createElement(T,null);var g=t.state?t.state.from.pathname:"/";if(h)return r.a.createElement(m.a,{to:g});function O(){return(O=Object(i.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x.requestTokens(o.email,o.password);case 2:return e.t0=b,e.next=5,x.fetchUserData();case 5:e.t1=e.sent,(0,e.t0)(e.t1),y(!1);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return r.a.createElement("div",null,r.a.createElement("form",{onSubmit:function(e){e.preventDefault(),y(!0),function(){O.apply(this,arguments)}()}},r.a.createElement("label",{htmlFor:"email"},"Adresse e-mail",r.a.createElement("input",{type:"email",name:"email",id:"email",placeholder:"test@example.com",value:o.email||"",onChange:u})),r.a.createElement("label",{htmlFor:"password"},"Mot de passe",r.a.createElement("input",{type:"password",name:"password",id:"password",value:o.password||"",onChange:u})),r.a.createElement("input",{type:"submit",value:"Me connecter"}),r.a.createElement(s.b,{to:"/"},"Home"),r.a.createElement(s.b,{to:"/register"},"S'inscrire")))};var I=function(e){var t=e.location;return r.a.createElement(F,{location:t})},D=a(12),A=a.n(D),M=function(){function e(){Object(b.a)(this,e)}return Object(v.a)(e,null,[{key:"getUserSpaces",value:function(){var e=Object(i.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,k.a.get("".concat("https://memory-school-api.herokuapp.com/","api/user/spaces"));case 3:if(!(t=e.sent)||!t.data){e.next=6;break}return e.abrupt("return",t.data.spaces);case 6:e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.error(e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(){return e.apply(this,arguments)}}()},{key:"createNewSpace",value:function(){var e=Object(i.a)(l.a.mark((function e(t){var a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,k.a.post("".concat("https://memory-school-api.herokuapp.com/","api/space/new"),t);case 3:(a=e.sent)&&a.data&&(console.log(a.data),console.log("nouvel espace cr\xe9\xe9")),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.log(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t){return e.apply(this,arguments)}}()},{key:"getUnvalidatedSpaces",value:function(){var e=Object(i.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,k.a.get("".concat("https://memory-school-api.herokuapp.com/","api/spaces/unvalidated"));case 3:if(!(t=e.sent)||!t.data){e.next=6;break}return e.abrupt("return",t.data.spaces);case 6:e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.error(e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(){return e.apply(this,arguments)}}()},{key:"getWaitingSubscribers",value:function(){var e=Object(i.a)(l.a.mark((function e(t){var a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,k.a.get("".concat("https://memory-school-api.herokuapp.com/","api/space/").concat(t,"/subscribers/waiting"));case 3:if(!(a=e.sent)){e.next=8;break}if(0!==a.data.subscribers.length){e.next=7;break}return e.abrupt("return","Aucun utilisateur en attente d'acc\xe8s");case 7:return e.abrupt("return",a.data.subscribers);case 8:e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),console.error(e.t0);case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t){return e.apply(this,arguments)}}()},{key:"validateSubscriber",value:function(){var e=Object(i.a)(l.a.mark((function e(t,a){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,k.a.put("".concat("https://memory-school-api.herokuapp.com/","api/space/").concat(t,"/subscriber/").concat(a,"/validate"));case 3:(n=e.sent)&&console.log(n),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.error(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,a){return e.apply(this,arguments)}}()},{key:"unvalidateSubscriber",value:function(){var e=Object(i.a)(l.a.mark((function e(t,a){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,k.a.put("".concat("https://memory-school-api.herokuapp.com/","api/space/").concat(t,"/subscriber/").concat(a,"/unvalidate"));case 3:(n=e.sent)&&console.log(n),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.error(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,a){return e.apply(this,arguments)}}()},{key:"validateSpace",value:function(){var e=Object(i.a)(l.a.mark((function e(t){var a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,k.a.put("".concat("https://memory-school-api.herokuapp.com/","api/spaces/").concat(t,"/validation"));case 3:(a=e.sent)&&(console.log(a&&a.data),console.log(a.data)),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.error(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t){return e.apply(this,arguments)}}()},{key:"deleteSpace",value:function(){var e=Object(i.a)(l.a.mark((function e(t){var a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,k.a.delete("".concat("https://memory-school-api.herokuapp.com/","api/space/").concat(t,"/delete"));case 3:(a=e.sent)&&console.log(a.data),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.error(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t){return e.apply(this,arguments)}}()},{key:"editSpace",value:function(){var e=Object(i.a)(l.a.mark((function e(t){var a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,k.a.put("".concat("https://memory-school-api.herokuapp.com/","api/space/").concat(t,"/edit"));case 3:(a=e.sent)&&console.log(a.data),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.error(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t){return e.apply(this,arguments)}}()},{key:"focusSpace",value:function(){var e=Object(i.a)(l.a.mark((function e(t){var a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,k.a.get("".concat("https://memory-school-api.herokuapp.com/","api/space/").concat(t));case 3:if(!(a=e.sent)||!a.data){e.next=7;break}return console.log("RUZE",a.data),e.abrupt("return",a.data);case 7:e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),console.error("ERR",e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t){return e.apply(this,arguments)}}()},{key:"errorMessageSpace",value:function(e){var t="";switch(e){case"SPACE_NOT_VALIDATED":t="Votre espace n'a pas encore \xe9t\xe9 valid\xe9 par MEMORY";break;case"SPACE_NOT_SUBSCRIBED":t="Vous n'\xeates pas membre de cet espace de m\xe9moire";break;case"SPACE_SUBSCRIBED_WAITING":t="Votre demande d'acc\xe8s est en cours de traitement par le manager de l'espace";break;case"SPACE_INVITATION_WAITING":t="Vous n'avez pas demander l'acc\xe8s \xe0 cet espace de m\xe9moire";break;default:t="Vous rencontrer un probl\xe8me pour acc\xe9der \xe0 cet espace? Contactez MEMORY"}return t}}]),e}();var B=function(e){var t=e.space,a=e.backOffice,c=e.validateSpace,o=e.index,u=Object(n.useState)(),l=Object(p.a)(u,2),i=l[0],m=l[1];return Object(n.useEffect)((function(){m((function(){return a?"/admin":"/space/".concat(t.firstName,"-").concat(t.lastName,"-").concat(t.id)}))}),[]),r.a.createElement("div",null,r.a.createElement(s.b,{to:{pathname:"".concat(i),state:{id:"".concat(t.id)}}},r.a.createElement("img",{width:"300",src:t.image.url,alt:t.firstName}),r.a.createElement("h1",null,t.firstName," ",t.lastName),r.a.createElement("h2",null,"N\xe9 le: ",A()(t.dateBirth).format("D MMMM YYYY"),", Mort le:"," ",A()(t.dateDeath).format("D MMMM YYYY")),r.a.createElement("p",null,t.description),a?r.a.createElement("button",{type:"button",onClick:function(){return c(t.id,o)}},"Valider l'espace"):""))};var P=function(e){var t=e.labelText,a=e.specificFieldName,n=e.isMultiple,c=e.handleChange,o=e.restrictedFileTypes,s=a||"images";return r.a.createElement("div",{className:"upload"},r.a.createElement("label",{htmlFor:s},t," : "),r.a.createElement("input",{type:"file",id:s,name:s,multiple:n,accept:o,onChange:c}))};var R=function(){var e=N(),t=Object(p.a)(e,2),a=t[0],c=t[1],o=Object(n.useState)([]),s=Object(p.a)(o,2),u=s[0],m=s[1],f=Object(n.useState)(),d=Object(p.a)(f,2),h=d[0],b=d[1];function v(){return E.apply(this,arguments)}function E(){return(E=Object(i.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=m,e.next=3,M.getUserSpaces();case 3:e.t1=e.sent,(0,e.t0)(e.t1);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(){return(k=Object(i.a)(l.a.mark((function e(t){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),!A()(a.dateBirth).isBefore(a.dateDeath)){e.next=9;break}return b(),n=C(a),e.next=6,M.createNewSpace(n);case 6:v(),e.next=10;break;case 9:b("La date de naissance ne peut pas etre avant la date d\xe9c\xe8s");case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(n.useEffect)((function(){v()}),[]),r.a.createElement("div",null,r.a.createElement("form",{action:"/spaces",method:"post",onSubmit:function(e){return k.apply(this,arguments)}},r.a.createElement(P,{labelText:"Photo du d\xe9funt",specificFieldName:"spaceImage",handleChange:c}),r.a.createElement(P,{labelText:"Preuve acte de d\xe9c\xe8s au format PDF",specificFieldName:"spaceProof",restrictedFileTypes:"application/pdf",handleChange:c}),r.a.createElement("label",{htmlFor:"lastName"},"Nom",r.a.createElement("input",{type:"text",name:"lastName",id:"lastName",value:a.lastName||"",onChange:c})),r.a.createElement("label",{htmlFor:"firstName"},"Pr\xe9nom",r.a.createElement("input",{type:"text",name:"firstName",id:"firstName",value:a.firstName||"",onChange:c})),r.a.createElement("label",{htmlFor:"dateBirth"},"Date de naissance",r.a.createElement("input",{type:"date",name:"dateBirth",id:"dateBirth",value:a.dateBirth||"",onChange:c})),r.a.createElement("label",{htmlFor:"dateDeath"},"Date de deces",r.a.createElement("input",{type:"date",name:"dateDeath",id:"dateDeath",value:a.dateDeath||"",onChange:c})),h&&r.a.createElement("p",null,h),r.a.createElement("label",{htmlFor:"description"},"Qui etait ce ?",r.a.createElement("textarea",{name:"description",id:"description",cols:"30",rows:"10",value:a.description||"",onChange:c})),r.a.createElement("label",{htmlFor:"relationDefunctText"},"Je suis son/sa...",r.a.createElement("textarea",{name:"relationDefunctText",id:"relationDefunctText",placeholder:"ami depuis 20 ans / petit-fils / voisine...",cols:"30",rows:"10",value:a.relationDefunctText||"",onChange:c})),r.a.createElement("button",{type:"submit"},"Creer un espace")),u&&u.map((function(e){return r.a.createElement(B,{key:e.space.id,space:e.space})})))};var U=function(){var e=Object(n.useContext)(d).user;return r.a.createElement("div",null,r.a.createElement("h2",null,e.firstName),r.a.createElement("h2",null,e.roles),r.a.createElement(R,null))},_=function(e){var t={};return e.email?/\S+@\S+\.\S+/.test(e.email)||(t.email="Invalide email adresse"):t.email="Veuillez entrer un email",e.passwordInitial?/^(?=.*\d)(?=.*[A-Z])[0-9a-zA-Z]{6,}$/.test(e.passwordInitial)||(t.passwordInitial="Le mot de passe doit contenir au moins 6 lettre, une minuscule, une majuscule et un nombre"):t.passwordInitial="Veuillez entrer un mot de passe",e.passwordFinal?e.passwordInitial!==e.passwordFinal&&(t.passwordFinal="Les mots de passe que vous avez entr\xe9s ne sont pas identiques"):t.passwordFinal="Veuillez confirmer le mot de passe",t};var V=function(){var e=N(),t=Object(p.a)(e,2),a=t[0],c=t[1],o=Object(n.useState)({}),u=Object(p.a)(o,2),f=u[0],h=u[1],b=Object(n.useContext)(d).user,v=Object(m.g)();if(b)return r.a.createElement(m.a,{to:"/"});var E=function(){var e=Object(i.a)(l.a.mark((function e(t){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),0!==Object.keys(_(a)).length){e.next=9;break}return h({}),n=C(a),e.next=6,x.createAccount(n,f,h);case 6:v.push("/account"),e.next=10;break;case 9:h(_(a));case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return r.a.createElement("div",null,r.a.createElement("p",null,"Cr\xe9er un compte"),r.a.createElement("form",{action:"/register",method:"post",onSubmit:E},r.a.createElement(P,{labelText:"Photo de profil",specificFieldName:"userImage",handleChange:c}),r.a.createElement("label",{htmlFor:"lastName"},"Nom",r.a.createElement("input",{type:"text",name:"lastName",id:"lastName",value:a.lastName||"",onChange:c})),r.a.createElement("label",{htmlFor:"firstName"},"Pr\xe9nom",r.a.createElement("input",{type:"text",name:"firstName",id:"firstName",value:a.firstName||"",onChange:c})),r.a.createElement("label",{htmlFor:"email"},"Email",r.a.createElement("input",{type:"email",name:"email",id:"email",value:a.email||"",onChange:c,placeholder:"test@example.com"})),f&&r.a.createElement("p",null,f.err401),f&&r.a.createElement("p",null,f.email),r.a.createElement("label",{htmlFor:"passwordInitial"},"Mot de passe",r.a.createElement("input",{type:"password",name:"passwordInitial",id:"passwordInitial",value:a.passwordInitial||"",onChange:c})),f&&r.a.createElement("p",null,f.passwordInitial),r.a.createElement("label",{htmlFor:"passwordFinal"},"Confirmer le mot de passe",r.a.createElement("input",{type:"password",name:"passwordFinal",id:"passwordFinal",value:a.passwordFinal||"",onChange:c})),f&&r.a.createElement("p",null,f.passwordFinal),r.a.createElement("button",{type:"submit"},"S'inscrire")),r.a.createElement(s.b,{to:"/"},"Go back Home"),r.a.createElement(s.b,{to:"/login"},"Se connecter"))};var W=function(){return r.a.createElement(V,null)},J=Object(n.createContext)(null),Y=function(){function e(){Object(b.a)(this,e)}return Object(v.a)(e,null,[{key:"createPost",value:function(){var e=Object(i.a)(l.a.mark((function e(t,a){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,k.a.post("".concat("https://memory-school-api.herokuapp.com/","api/space/").concat(t,"/post/new"),a);case 3:if(!(n=e.sent)||!n.data){e.next=8;break}return console.log(n.data),console.log("nouveau post cr\xe9\xe9"),e.abrupt("return",n.data);case 8:e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),console.error(e.t0);case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t,a){return e.apply(this,arguments)}}()},{key:"deletePost",value:function(){var e=Object(i.a)(l.a.mark((function e(t){var a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,k.a.delete("".concat("https://memory-school-api.herokuapp.com/","api/post/").concat(t,"/delete"));case 3:(a=e.sent)&&console.log(a.data),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.log(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t){return e.apply(this,arguments)}}()}]),e}();var z=function(e){var t=e.post,a=e.index,c=e.deletePost,o=Object(n.useContext)(d).user;return r.a.createElement("div",null,t.img&&r.a.createElement("img",{src:t.img,alt:"post img"}),r.a.createElement("h1",null,t.title),r.a.createElement("p",null,t.text),r.a.createElement("div",null,r.a.createElement("img",Object.assign({src:t.createdBy.image.url,style:{width:"40px"}},{height:"40px"},{alt:"profile pic of author"})),r.a.createElement("p",null,t.createdBy.firstName," ",t.createdBy.lastName)),o.id===t.createdBy.id?r.a.createElement("button",{type:"button",onClick:function(){return c(t.id,a)}},"Supprimer le post"):"")};var H=function(){var e=Object(n.useState)({}),t=Object(p.a)(e,2),a=t[0],c=t[1],o=Object(n.useState)({}),u=Object(p.a)(o,2),f=u[0],h=u[1],b=Object(n.useState)(""),v=Object(p.a)(b,2),E=v[0],k=v[1],y=(Object(n.useContext)(J).setValue,Object(m.h)()),g=Object(n.useContext)(d).user,x=N(),O=Object(p.a)(x,2),j=O[0],w=O[1];function S(){return T.apply(this,arguments)}function T(){return(T=Object(i.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,M.focusSpace(y.state.id);case 2:t=e.sent,console.log(t),t.status?(console.log(M.errorMessageSpace(t.status)),k(M.errorMessageSpace(t.status))):(c(t),h(t.space));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function F(){return(F=Object(i.a)(l.a.mark((function e(t){var a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),a=C(j),e.next=4,Y.createPost(y.state.id,a);case 4:S();case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function I(e,t){return D.apply(this,arguments)}function D(){return(D=Object(i.a)(l.a.mark((function e(t,a){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Y.deletePost(t);case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(n.useEffect)((function(){S()}),[]),E?r.a.createElement("div",null,r.a.createElement("p",null,"Pas cool"),r.a.createElement("p",null,E)):r.a.createElement("div",null,r.a.createElement("p",null,"Bienvenu dans l'espace de ",f.firstName," ",f.lastName,console.log(a.posts)),JSON.stringify(f.createdBy)===JSON.stringify(g)?r.a.createElement(s.b,{to:{pathname:"/space/".concat(f.firstName,"-").concat(f.lastName,"-").concat(y.state.id,"/settings"),state:{id:"".concat(y.state.id)}}},r.a.createElement("button",{type:"button"},"Settings")):"",r.a.createElement("form",{action:"/",method:"post",onSubmit:function(e){return F.apply(this,arguments)}},r.a.createElement("label",{htmlFor:"content"},r.a.createElement("input",{type:"textarea",name:"text",id:"content",value:j.text||"",onChange:w})),r.a.createElement("button",{type:"submit"},"poster un souvenir")),a.posts&&a.posts.map((function(e,t){return r.a.createElement(z,{key:e.id,post:e,index:t,deletePost:I})})))};var L=function(){return r.a.createElement("div",null,"Page non trouv\xe9e (erreur 404).",r.a.createElement(s.b,{to:"/"},"Retourner \xe0 la page d'accueil"))};var q=function(){return r.a.createElement(L,null)};var G=function(){var e=Object(n.useContext)(d).user,t=Object(n.useState)([]),a=Object(p.a)(t,2),c=a[0],o=a[1];function s(e,t){M.validateSpace(e),c.splice(t,1),o(Object(j.a)(c))}return Object(n.useEffect)((function(){function e(){return(e=Object(i.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=o,e.next=3,M.getUnvalidatedSpaces();case 3:e.t1=e.sent,(0,e.t0)(e.t1);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[]),r.a.createElement("div",null,r.a.createElement("p",null,e.firstName),c.map((function(e,t){return r.a.createElement(B,{key:e.id,index:t,space:e,backOffice:!0,validateSpace:s})})))};var Z=function(){var e=Object(m.h)(),t=Object(n.useState)(),a=Object(p.a)(t,2),c=a[0],o=a[1],s=Object(n.useState)("Chargement des utilisateurs ayant fait une demande d'acc\xe8s..."),u=Object(p.a)(s,2),f=u[0],d=u[1];function h(){return(h=Object(i.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=o,e.next=3,M.deleteSpace(t);case 3:e.t1=e.sent,(0,e.t0)(e.t1);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function b(){return(b=Object(i.a)(l.a.mark((function t(){var a;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,M.getWaitingSubscribers(e.state.id);case 2:a=t.sent,d(a);case 4:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function v(){return(v=Object(i.a)(l.a.mark((function t(a){return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,M.validateSubscriber(e.state.id,a);case 2:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function E(){return(E=Object(i.a)(l.a.mark((function t(a){return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,M.unvalidateSubscriber(e.state.id,a);case 2:case"end":return t.stop()}}),t)})))).apply(this,arguments)}return Object(n.useEffect)((function(){!function(){b.apply(this,arguments)}()}),[]),c?r.a.createElement(m.a,{to:"/"}):r.a.createElement("div",null,r.a.createElement("div",null,r.a.createElement("h2",null,"Utilisateurs ayant fait une demande d'acc\xe8s"),r.a.createElement("ul",null,f instanceof Array?f.map((function(e){return r.a.createElement("li",{key:e.id},"Nom: ",e.firstName,r.a.createElement("button",{onClick:function(){return function(e){return v.apply(this,arguments)}(e.id)},type:"button"},"Accepter la demande"),r.a.createElement("button",{onClick:function(){return function(e){return E.apply(this,arguments)}(e.id)},type:"button"},"Refuser la demande"))})):f)),r.a.createElement("div",null,r.a.createElement("button",{type:"button",onClick:function(){return function(e){return h.apply(this,arguments)}(e.state.id)}},"Supprimer l'espace")))};var $=Object(m.i)((function(){var e=Object(n.useState)({}),t=Object(p.a)(e,2),a=t[0],c=t[1],o=Object(n.useMemo)((function(){return{value:a,setValue:c}}),[a,c]);return r.a.createElement(m.d,null,r.a.createElement(m.b,{path:"/",exact:!0,component:O}),r.a.createElement(m.b,{path:"/login",exact:!0,component:I}),r.a.createElement(m.b,{path:"/register",exact:!0,component:W}),r.a.createElement(h,{path:"/account",exact:!0,component:U}),r.a.createElement(J.Provider,{value:o},r.a.createElement(h,{path:"/space/:slug",exact:!0,component:H}),r.a.createElement(h,{path:"/admin",exact:!0,component:G}),r.a.createElement(h,{path:"/space/:slug/settings",exact:!0,component:Z})),r.a.createElement(m.b,{component:q})," ")}));a(67);g.setInterceptors();var K=function(){var e=Object(n.useState)(null),t=Object(p.a)(e,2),a=t[0],c=t[1],o=Object(n.useState)(!0),s=Object(p.a)(o,2),u=s[0],m=s[1],f=Object(n.useMemo)((function(){return{user:a,setUser:c}}),[a,c]);function h(){return(h=Object(i.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x.refreshTokens();case 2:return e.t0=c,e.next=5,x.fetchUserData();case 5:e.t1=e.sent,(0,e.t0)(e.t1),m(!1);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(n.useEffect)((function(){null!==x.getRefreshToken()?function(){h.apply(this,arguments)}():(console.log("Aucun refresh token trouv\xe9, pas d'autologin possible."),m(!1))}),[]),u?r.a.createElement(T,null):r.a.createElement("div",{className:"App"},r.a.createElement(d.Provider,{value:f},r.a.createElement($,null)))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(s.a,null,r.a.createElement(K,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[36,1,2]]]);
//# sourceMappingURL=main.d589a33d.chunk.js.map